---
import AddToCartButton from '../AddToCartButton.svelte';
import { formatCurrency } from '../../utils';
import { UPLOADS_URL } from '../../services/ecommerce';

interface Props {
  class?:string,
  product: any;
}
const {class: className, product } = Astro.props;

---

<a 
href=`/${product.categories[0].slug}/${product.slug}` 
id={'product-card-' + product._id}
class={"product-card flex flex-col bg-white overflow-hidden dark:bg-gray-800 dark:border-gray-700 " + className || ''}>
    
    
    <picture class="product-card-picture flex rounded-xl rounded-b-none overflow-hidden">
        <img width="435" height="326" transition:name=`${product.slug}` src={UPLOADS_URL + product.images[0]?.file} alt={"Imagen del producto " + product.name}>
    </picture>
    <div class="px-6 flex-auto flex flex-col justify-between">
        <div>
            <div class="flex justify-center gap-10">
                <h2 class="product-card-title text-gray-900 font-semibold text-lg tracking-tight dark:text-white">
                    {product.name}
                </h2>
            </div>
            <div class="flex items-center justify-center flex-wrap gap-2 mt-2.5">
                <!-- <div class="flex items-center">
                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                        </path>
                    </svg>
                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                        </path>
                    </svg>
                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                        </path>
                    </svg>
                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                        </path>
                    </svg>
                    <svg class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                        </path>
                    </svg>
                    <span class="bg-blue-100 text-blue-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded dark:bg-blue-200 dark:text-blue-800 ml-3">5.0</span>
                </div> -->
    
                <span class="text-[#4CAF50] product-card-price text-xl font-bold text-gray-900 dark:text-white">
                    {formatCurrency(product.price)}
                </span>
            </div>
        </div>
        <!-- <div class="flex items-center justify-between">
            {
                product.out_of_stock ?
                    <div class="card-actions w-full">
                        <button class="w-full text-[#222] bg-gray-100 font-medium rounded-xl text-sm px-5 py-3 text-center">
                            No hay stock
                        </button>
                    </div>
                :
                <div class="card-actions  w-full">
                    { product.attributes?.length > 0 ?
                        <button class="w-full text-white bg-[#111] font-medium rounded-xl text-sm px-5 py-3 text-center">
                        + Ver opciones
                        </button>
                        :
                        <AddToCartButton client:load product={product} quantity={1} size="small"></AddToCartButton>
                    }
                </div>
            }
        </div> -->
    </div>
    

    <footer class="product-card-footer">
        <div class="product-card-footer-cell">
            { product.attributes?.length > 0 ?
                <button class="view-options-btn w-full font-medium text-sm">
                + Ver opciones
                </button>
                :
                <AddToCartButton client:load product={product} quantity={1} buttonType="circle" size="small"></AddToCartButton>
            }
            
        </div>
    </footer>
</a>

<style>
    .view-options-btn {
        color: #000;
        background: transparent;
        border-radius: 0;
        padding: 2rem 2rem;
        font-weight: 500;
        text-transform: uppercase;
        text-align: center;
    }
    picture {
        aspect-ratio: 1 / 1;

        img {
            object-fit: contain;
            height: 100%;
            transition: transform 0.4s ease;
        }
    }

    .product-card {
        outline: 1px solid #000;
        border-radius: 0;
        position: relative;
    }

    .product-card-title {
        line-height: 1.5;
        font-weight: 600;
        font-size: 0.95em;
        text-align: center;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .product-card-footer {
        display: flex;
        justify-content: center;
        width: 100%;
        margin: 2rem 0 0;
        outline: 1px solid;
    }

    .product-card-footer-cell {
        display: flex;
        justify-content: center;
        width: 100%;
    }
</style>

<style is:global>
    .product-card:hover {
        .circle-add-to-cart-button {
            background: #fbf0ec;
            color: #ef5726;
        }

        img {
            transform: scale(1.1);
        }
    }

    #product-card-66777d88095d314bb02b03bb img, 
    #product-card-66777dfe095d314bb02b0540 img {
        padding: 1.5rem;
    }
</style>

<script>
    import VanillaTilt from 'vanilla-tilt';
    
    function initTilt(){
      const els = document.querySelectorAll(".product-card-picture");
  
      els.forEach(el => {
        const tilt = new VanillaTilt(el as any, {
          max: 15,
          speed: 500,
          perspective: 800,
        });
        
      });
  
    }
  
    document.addEventListener("DOMContentLoaded", initTilt);
  
    document.addEventListener('astro:after-swap', (e) => {
      initTilt();
    })
  </script>